<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>٦٠ حزب من القرآن الكريم</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Amiri', serif;
            font-weight: 400;
            color: #1a1a1a;               /* noir doux, très reposant pour les yeux */
            background: #ffffff;
            line-height: 2;
            direction: rtl;
            text-align: right;
            padding: 20px;
            max-width: 100%;
            overflow-x: hidden;
        }
        #progress {
            margin-bottom: 25px;
            text-align: center;
            font-size: 22px;
            color: #1565c0;
        }
        #content {
            font-size: 24px;
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #fffef7;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }
        .surah-title {
            font-size: 32px;
            color: #0d47a1;
            text-align: center;
            margin: 30px 0 20px;
            border-bottom: 2px solid #bbdefb;
            padding-bottom: 10px;
        }
        select, button, input {
            font-family: 'Amiri', serif;
            font-size: 18px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #90caf9;
            width: 100%;
            margin: 10px 0;
        }
        button {
            background: #1565c0;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover { background: #0d47a1; }
        button.undo { background: #c62828; }
        button.undo:hover { background: #b71c1c; }
        button.reset {
            background: #f9a825;
            color: #0d1b2a;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
        }
        #loading { text-align: center; margin: 20px; color: #757575; font-style: italic; }
    </style>
</head>
<body>

    <div id="progress">
        التقدم: <span id="count">٠/٦٠</span> (<span id="percent">٠٪</span>)
    </div>

    <select id="hizbSelect" onchange="loadHizb(this.value)">
        <option value="">اختر حزبًا</option>
    </select>

    <div id="loading" style="display:none;">جاري التحميل...</div>

    <div id="content"></div>

    <button class="reset" onclick="resetProgress()">إعادة تعيين التقدم</button>

    <script>
        // Colle ici ton tableau hizbRanges complet (celui de la version qui marche)
        const hizbRanges = [ /* ... ton tableau avec les 60 hizbs ... */ ];

        const surahNames = [
            '', 'الفاتحة', 'البقرة', 'آل عمران', 'النساء', 'المائدة', 'الأنعام', 'الأعراف', 'الأنفال', 'التوبة',
            'يونس', 'هود', 'يوسف', 'الرعد', 'إبراهيم', 'الحجر', 'النحل', 'الإسراء', 'الكهف', 'مريم', 'طه',
            'الأنبياء', 'الحج', 'المؤمنون', 'النور', 'الفرقان', 'الشعراء', 'النمل', 'القصص', 'العنكبوت', 'الروم',
            'لقمان', 'السجدة', 'الأحزاب', 'سبأ', 'فاطر', 'يس', 'الصافات', 'ص', 'الزمر', 'غافر', 'فصلت', 'الشورى',
            'الزخرف', 'الدخان', 'الجاثية', 'الأحقاف', 'محمد', 'الفتح', 'الحجرات', 'ق', 'الذاريات', 'الطور', 'النجم',
            'القمر', 'الرحمن', 'الواقعة', 'الحديد', 'المجادلة', 'الحشر', 'الممتحنة', 'الصف', 'الجمعة', 'المنافقون',
            'التغابن', 'الطلاق', 'التحريم', 'الملك', 'القلم', 'الحاقة', 'المعارج', 'نوح', 'الجن', 'المزمل', 'المدثر',
            'القيامة', 'الإنسان', 'المرسلات', 'النبأ', 'النازعات', 'عبس', 'التكوير', 'الانفطار', 'المطففين', 'الانشقاق',
            'البروج', 'الطارق', 'الأعلى', 'الغاشية', 'الفجر', 'البلد', 'الشمس', 'الليل', 'الضحى', 'الشرح', 'التين',
            'العلق', 'القدر', 'البينة', 'الزلزلة', 'العاديات', 'القارعة', 'التكاثر', 'العصر', 'الهمزة', 'الفيل',
            'قريش', 'الماعون', 'الكوثر', 'الكافرون', 'النصر', 'المسد', 'الإخلاص', 'الفلق', 'الناس'
        ];

        let readHizbs = JSON.parse(localStorage.getItem('hizbsRead')) || [];

        function updateProgress() {
            const count = readHizbs.length;
            const percent = (count / 60 * 100).toFixed(0);
            document.getElementById('count').textContent = count + '/٦٠';
            document.getElementById('percent').textContent = percent + '٪';
        }

        function renderHizbSelect() {
            const select = document.getElementById('hizbSelect');
            select.innerHTML = '<option value="">اختر حزبًا</option>';
            for (let i = 1; i <= 60; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `الحزب ${i}`;
                if (readHizbs.includes(i)) {
                    option.textContent += ' ✓';
                }
                select.appendChild(option);
            }
        }

        async function loadHizb(hizbNum) {
            if (!hizbNum) return;
            document.getElementById('loading').style.display = 'block';
            const content = document.getElementById('content');
            content.innerHTML = '';

            try {
                let text = '';
                let currentSurah = 0;
                const range = hizbRanges[hizbNum - 1];
                for (const part of range.parts) {
                    if (part.surah !== currentSurah) {
                        text += `<div class="surah-title">سورة ${surahNames[part.surah]}</div>`;
                        currentSurah = part.surah;
                    }
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${part.surah}/quran-uthmani`);
                    const data = await response.json();
                    const ayahs = data.data.ayahs;
                    for (let a = part.start; a <= part.end; a++) {
                        const ayah = ayahs.find(ay => ay.numberInSurah === a);
                        if (ayah) text += ayah.text + ' ۝ ';
                    }
                }
                const isRead = readHizbs.includes(Number(hizbNum));
                let buttons = `<br><button onclick="markDone(${hizbNum})">منتهي ✓</button>`;
                if (isRead) buttons += ` <button class="undo" onclick="unmarkDone(${hizbNum})">إلغاء ✗</button>`;
                content.innerHTML = text + buttons;
            } catch (e) {
                content.innerHTML = 'حدث خطأ أثناء التحميل، جرب لاحقًا.';
            }
            document.getElementById('loading').style.display = 'none';
        }

        function markDone(hizbNum) {
            if (!readHizbs.includes(hizbNum)) {
                readHizbs.push(hizbNum);
                localStorage.setItem('hizbsRead', JSON.stringify(readHizbs));
                renderHizbSelect();
                updateProgress();
                document.getElementById('content').innerHTML = '';
            }
        }

        function unmarkDone(hizbNum) {
            readHizbs = readHizbs.filter(h => h !== hizbNum);
            localStorage.setItem('hizbsRead', JSON.stringify(readHizbs));
            renderHizbSelect();
            updateProgress();
            document.getElementById('content').innerHTML = '';
        }

        function resetProgress() {
            if (confirm('هل أنت متأكد من إعادة تعيين كل التقدم؟')) {
                readHizbs = [];
                localStorage.setItem('hizbsRead', JSON.stringify(readHizbs));
                renderHizbSelect();
                updateProgress();
                document.getElementById('content').innerHTML = '';
            }
        }

        // Initialisation
        renderHizbSelect();
        updateProgress();
    </script>
</body>
</html>
