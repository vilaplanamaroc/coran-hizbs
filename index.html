<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù¦Ù  Ø­Ø²Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ•Œ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { 
            overflow-x: hidden; 
            max-width: 100%; 
            min-height: 100vh; 
            background: #f9f5eb; /* beige clair reposant */
            color: #1a1a1a; 
            font-family: 'Amiri', serif; 
            touch-action: manipulation; /* Ã©vite zoom indÃ©sirable */
        }
        body { padding: 20px; }
        #progress { margin-bottom: 25px; text-align: center; font-size: 22px; color: #1e88e5; }
        #progress-circle { width: 110px; height: 110px; margin: 10px auto; }
        select, input { 
            width: 100%; 
            padding: 14px; 
            font-size: 20px; 
            border: 2px solid #90caf9; 
            border-radius: 12px; 
            background: #fff; 
            margin-bottom: 18px; 
            box-shadow: 0 3px 8px rgba(30,136,229,0.15); 
        }
        select option[style*="color"] { font-weight: bold; }
        #content { 
            direction: rtl; 
            white-space: pre-wrap; 
            line-height: 2.1; 
            background: #ffffff; 
            padding: 28px; 
            border-radius: 16px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.08); 
            transition: all 0.4s ease; 
            opacity: 0; 
            transform: translateY(10px); 
        }
        #content.loaded { opacity: 1; transform: translateY(0); }
        .surah-title { 
            font-size: 32px; 
            color: #1565c0; 
            text-align: center; 
            margin: 35px 0 20px; 
            border-bottom: 3px solid #bbdefb; 
            padding-bottom: 12px; 
        }
        button { 
            padding: 14px 30px; 
            background: #1e88e5; 
            color: white; 
            border: none; 
            border-radius: 12px; 
            font-size: 18px; 
            cursor: pointer; 
            transition: all 0.3s; 
            box-shadow: 0 4px 10px rgba(30,136,229,0.2); 
            margin: 10px 6px; 
        }
        button:hover { background: #1565c0; transform: translateY(-3px); box-shadow: 0 8px 18px rgba(30,136,229,0.3); }
        button.undo { background: #ef5350; }
        button.undo:hover { background: #d32f2f; }
        button.reset { background: #42a5f5; width: 100%; margin-top: 20px; }
        #font-size { display: flex; align-items: center; font-size: 18px; margin: 20px 0; color: #424242; }
        #font-slider { flex: 1; margin-right: 15px; accent-color: #1e88e5; }
        #favorites, #history { margin-top: 35px; }
        .item { 
            background: #e8f0fe; 
            padding: 14px; 
            border-radius: 12px; 
            margin-bottom: 14px; 
            cursor: pointer; 
            border-right: 5px solid #1e88e5; 
            transition: background 0.3s; 
        }
        .item:hover { background: #bbdefb; }
        #loading { text-align: center; margin: 30px; font-size: 20px; color: #757575; }
        h3 { color: #1565c0; margin-bottom: 18px; text-align: center; font-size: 24px; }
    </style>
</head>
<body>
    <div id="progress">
        Ø§Ù„ØªÙ‚Ø¯Ù…: <span id="count">Ù /Ù¦Ù </span> (<span id="percent">Ù Ùª</span>)
        <svg id="progress-circle" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#e3f2fd" stroke-width="12"/>
            <circle cx="50" cy="50" r="45" fill="none" stroke="#1e88e5" stroke-width="12" stroke-dasharray="283" stroke-dashoffset="283" id="progress-ring"/>
        </svg>
    </div>

    <select id="hizbSelect" onchange="loadHizb(this.value)">
        <option value="">Ø§Ø®ØªØ± Ø­Ø²Ø¨Ù‹Ø§</option>
    </select>

    <select id="surahSelect" onchange="loadSurah(this.value)">
        <option value="">Ø§Ù„ØªÙ†Ù‚Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ±Ø©</option>
    </select>

    <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†Øµ..." oninput="searchText(this.value)">

    <div id="font-size">Ø­Ø¬Ù… Ø§Ù„Ù†Øµ: <input type="range" id="font-slider" min="16" max="36" value="24" oninput="adjustFont(this.value)"></div>

    <div id="loading" style="display:none;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª...</div>

    <div id="content"></div>

    <button class="reset" onclick="resetProgress()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>

    <div id="favorites"><h3>Ø§Ù„Ù…ÙØ¶Ù„Ø©</h3></div>
    <div id="history"><h3>Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®ÙŠØ±</h3></div>

    <script>
        const hizbRanges = [ /* colle ici le tableau complet des hizbRanges que tu avais au dÃ©but */ ];
        const surahNames = [ /* colle ici le tableau complet des noms de sourates en arabe */ ];

        let readHizbs = JSON.parse(localStorage.getItem('hizbsRead')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let history = JSON.parse(localStorage.getItem('history')) || [];

        function updateProgress() {
            const count = readHizbs.length;
            const percent = (count / 60 * 100).toFixed(0);
            document.getElementById('count').textContent = count + '/Ù¦Ù ';
            document.getElementById('percent').textContent = percent + 'Ùª';
            document.getElementById('progress-ring').style.strokeDashoffset = 283 - (283 * percent / 100);
        }

        function renderHizbSelect() {
            const select = document.getElementById('hizbSelect');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø­Ø²Ø¨Ù‹Ø§</option>';
            for (let i = 1; i <= 60; i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = `Ø§Ù„Ø­Ø²Ø¨ ${i}`;
                if (readHizbs.includes(i)) {
                    opt.style.color = '#2e7d32'; // vert foncÃ©
                    opt.style.fontWeight = 'bold';
                    opt.textContent += ' â€¢ Ù…Ù†ØªÙ‡ÙŠ';
                }
                select.appendChild(opt);
            }
        }

        function renderSurahSelect() {
            const select = document.getElementById('surahSelect');
            select.innerHTML = '<option value="">Ø§Ù„ØªÙ†Ù‚Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ±Ø©</option>';
            surahNames.forEach((name, idx) => {
                if (idx > 0) {
                    const opt = document.createElement('option');
                    opt.value = idx;
                    opt.textContent = name;
                    select.appendChild(opt);
                }
            });
        }

        async function loadHizb(num) {
            if (!num) return;
            document.getElementById('loading').style.display = 'block';
            const content = document.getElementById('content');
            content.innerHTML = '';
            content.classList.remove('loaded');

            try {
                let text = '';
                let currentSurah = 0;
                const range = hizbRanges[num - 1];
                for (const part of range.parts) {
                    const res = await fetch(`https://api.alquran.cloud/v1/surah/${part.surah}/quran-uthmani`);
                    const data = await res.json();
                    if (part.surah !== currentSurah) {
                        text += `<div class="surah-title">Ø³ÙˆØ±Ø© ${surahNames[part.surah]}</div>`;
                        currentSurah = part.surah;
                    }
                    const ayahs = data.data.ayahs;
                    for (let i = part.start; i <= part.end; i++) {
                        const ayah = ayahs.find(a => a.numberInSurah === i);
                        if (ayah) text += ayah.text + ' Û ';
                    }
                }
                const isRead = readHizbs.includes(Number(num));
                let btns = `<br><button onclick="markDone(${num})">Ù…Ù†ØªÙ‡ÙŠ âœ“</button>`;
                if (isRead) btns += ` <button class="undo" onclick="unmarkDone(${num})">Ø¥Ù„ØºØ§Ø¡ âœ—</button>`;
                btns += `<br><button onclick="addFavorite('Ø­Ø²Ø¨ ${num}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø© â˜…</button>`;
                content.innerHTML = text + btns;
                content.classList.add('loaded');
                content.scrollIntoView({ behavior: 'smooth' });
                addToHistory(`Ø­Ø²Ø¨ ${num}`);
            } catch (e) {
                content.innerHTML = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§.';
            }
            document.getElementById('loading').style.display = 'none';
        }

        // Fonctions markDone, unmarkDone, resetProgress, addFavorite, renderFavorites, addToHistory, renderHistory restent similaires
        // Adapte les textes en arabe et appelle renderHizbSelect() + renderSurahSelect() + updateProgress() au dÃ©marrage

        // Exemple resetProgress corrigÃ©
        function resetProgress() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…ØŸ')) {
                readHizbs = [];
                localStorage.setItem('hizbsRead', JSON.stringify(readHizbs));
                renderHizbSelect();
                updateProgress();
                document.getElementById('content').innerHTML = '';
            }
        }

        // Appel initial
        renderHizbSelect();
        renderSurahSelect();
        updateProgress();
        // Ajoute renderFavorites(); renderHistory(); si tu gardes ces sections
    </script>
</body>
</html>
