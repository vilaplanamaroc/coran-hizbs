<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>٦٠ حزب من القرآن الكريم</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Amiri', serif;
            color: #1a1a1a;               /* noir doux, très reposant */
            background: #ffffff;
            line-height: 2;
            font-size: 22px;
            direction: rtl;
            padding: 20px;
            max-width: 100%;
            overflow-x: hidden;
        }
        #progress {
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            color: #1565c0;
        }
        select, button {
            font-family: 'Amiri', serif;
            font-size: 20px;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            margin: 12px 0;
        }
        select { border: 1px solid #90caf9; }
        button {
            background: #1565c0;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover { background: #0d47a1; }
        button.undo { background: #c62828; }
        button.undo:hover { background: #b71c1c; }
        button.reset {
            background: #f9a825;
            color: #0d1b2a;
            font-weight: bold;
            margin-top: 20px;
        }
        #content {
            background: #fffef7;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .surah-title {
            font-size: 32px;
            color: #0d47a1;
            text-align: center;
            margin: 30px 0 20px;
            border-bottom: 2px solid #bbdefb;
            padding-bottom: 10px;
        }
        #loading { 
            text-align: center; 
            margin: 30px 0; 
            color: #757575; 
            font-style: italic; 
        }
    </style>
</head>
<body>

    <div id="progress">
        التقدم: <span id="count">٠/٦٠</span> (<span id="percent">٠٪</span>)
    </div>

    <select id="hizbSelect" onchange="loadHizb(this.value)">
        <option value="">اختر حزبًا</option>
    </select>

    <div id="loading" style="display:none;">جاري التحميل...</div>

    <div id="content"></div>

    <button class="reset" onclick="resetProgress()">إعادة تعيين التقدم</button>

    <script>
        // Remplace par TON tableau hizbRanges exact (celui de la version qui marchait)
        const hizbRanges = [
            {hizb:1, parts:[{surah:1,start:1,end:7},{surah:2,start:1,end:74}]},
            // ... colle ici les 60 entrées de ton ancien code qui fonctionnait ...
            {hizb:60, parts:[{surah:87,start:1,end:19},{surah:88,start:1,end:26},{surah:89,start:1,end:30},{surah:90,start:1,end:20},{surah:91,start:1,end:15},{surah:92,start:1,end:21},{surah:93,start:1,end:11},{surah:94,start:1,end:8},{surah:95,start:1,end:8},{surah:96,start:1,end:19},{surah:97,start:1,end:5},{surah:98,start:1,end:8},{surah:99,start:1,end:8},{surah:100,start:1,end:11},{surah:101,start:1,end:11},{surah:102,start:1,end:8},{surah:103,start:1,end:3},{surah:104,start:1,end:9},{surah:105,start:1,end:5},{surah:106,start:1,end:4},{surah:107,start:1,end:7},{surah:108,start:1,end:3},{surah:109,start:1,end:6},{surah:110,start:1,end:3},{surah:111,start:1,end:5},{surah:112,start:1,end:4},{surah:113,start:1,end:5},{surah:114,start:1,end:6}]}
        ];

        const surahNames = [
            '', 'الفاتحة', 'البقرة', 'آل عمران', 'النساء', 'المائدة', 'الأنعام', 'الأعراف', 'الأنفال', 'التوبة',
            'يونس', 'هود', 'يوسف', 'الرعد', 'إبراهيم', 'الحجر', 'النحل', 'الإسراء', 'الكهف', 'مريم', 'طه',
            'الأنبياء', 'الحج', 'المؤمنون', 'النور', 'الفرقان', 'الشعراء', 'النمل', 'القصص', 'العنكبوت', 'الروم',
            'لقمان', 'السجدة', 'الأحزاب', 'سبأ', 'فاطر', 'يس', 'الصافات', 'ص', 'الزمر', 'غافر', 'فصلت', 'الشورى',
            'الزخرف', 'الدخان', 'الجاثية', 'الأحقاف', 'محمد', 'الفتح', 'الحجرات', 'ق', 'الذاريات', 'الطور', 'النجم',
            'القمر', 'الرحمن', 'الواقعة', 'الحديد', 'المجادلة', 'الحشر', 'الممتحنة', 'الصف', 'الجمعة', 'المنافقون',
            'التغابن', 'الطلاق', 'التحريم', 'الملك', 'القلم', 'الحاقة', 'المعارج', 'نوح', 'الجن', 'المزمل', 'المدثر',
            'القيامة', 'الإنسان', 'المرسلات', 'النبأ', 'النازعات', 'عبس', 'التكوير', 'الانفطار', 'المطففين', 'الانشقاق',
            'البروج', 'الطارق', 'الأعلى', 'الغاشية', 'الفجر', 'البلد', 'الشمس', 'الليل', 'الضحى', 'الشرح', 'التين',
            'العلق', 'القدر', 'البينة', 'الزلزلة', 'العاديات', 'القارعة', 'التكاثر', 'العصر', 'الهمزة', 'الفيل',
            'قريش', 'الماعون', 'الكوثر', 'الكافرون', 'النصر', 'المسد', 'الإخلاص', 'الفلق', 'الناس'
        ];

        let readHizbs = JSON.parse(localStorage.getItem('hizbsRead')) || [];

        function updateProgress() {
            const count = readHizbs.length;
            const percent = (count / 60 * 100).toFixed(0);
            document.getElementById('count').textContent = count + '/٦٠';
            document.getElementById('percent').textContent = percent + '٪';
        }

        function renderHizbSelect() {
            const select = document.getElementById('hizbSelect');
            select.innerHTML = '<option value="">اختر حزبًا</option>';
            for (let i = 1; i <= 60; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `الحزب ${i}`;
                if (readHizbs.includes(i)) option.textContent += ' ✓';
                select.appendChild(option);
            }
        }

        async function loadHizb(hizbNum) {
            if (!hizbNum) return;
            document.getElementById('loading').style.display = 'block';
            const content = document.getElementById('content');
            content.innerHTML = '';

            try {
                let text = '';
                let currentSurah = 0;
                const range = hizbRanges[hizbNum - 1];
                for (const part of range.parts) {
                    if (part.surah !== currentSurah) {
                        text += `<div class="surah-title">سورة ${surahNames[part.surah]}</div>`;
                        currentSurah = part.surah;
                    }
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${part.surah}/quran-uthmani`);
                    const data = await response.json();
                    const ayahs = data.data.ayahs;
                    for (let a = part.start; a <= part.end; a++) {
                        const ayah = ayahs.find(ay => ay.numberInSurah === a);
                        if (ayah) text += ayah.text + ' ۝ ';
                    }
                }
                const isRead = readHizbs.includes(Number(hizbNum));
                let buttons = `<br><button onclick="markDone(${hizbNum})">منتهي ✓</button>`;
                if (isRead) buttons += ` <button class="undo" onclick="unmarkDone(${hizbNum})">إلغاء ✗</button>`;
                content.innerHTML = text + buttons;
            } catch (e) {
                content.innerHTML = 'حدث خطأ، جرب لاحقًا أو تحقق من الإنترنت.';
                console.error(e);
            }
            document.getElementById('loading').style.display = 'none';
        }

        function markDone(hizbNum) {
            if (!readHizbs.includes(hizbNum)) {
                readHizbs.push(hizbNum);
                localStorage.setItem('hizbsRead', JSON.stringify(readHizbs));
                renderHizbSelect();
                updateProgress();
                document.getElementById('content').innerHTML = '';
            }
        }

        function unmarkDone(hizbNum) {
            readHizbs = readHizbs.filter(h => h !== hizbNum);
            localStorage.setItem('hizbsRead', JSON.stringify(readHizbs));
            renderHizbSelect();
            updateProgress();
            document.getElementById('content').innerHTML = '';
        }

        function resetProgress() {
            if (confirm('هل تريد إعادة تعيين كل التقدم؟')) {
                readHizbs = [];
                localStorage.setItem('hizbsRead', JSON.stringify(readHizbs));
                renderHizbSelect();
                updateProgress();
                document.getElementById('content').innerHTML = '';
            }
        }

        renderHizbSelect();
        updateProgress();
    </script>
</body>
</html>
